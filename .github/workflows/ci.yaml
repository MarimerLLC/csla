name: main

on:
  push:
    branches: [ main, v7.x, v8.x, v9.x, feature/4691-MAUI_CI_Build ]
    paths: ['Source/**', '.github/workflows/**']
  pull_request:
    branches: [ main, v7.x, v8.x, v9.x ]
    paths: ['Source/**', '.github/workflows/**']

jobs:
  Build_CSLA_Main:
    name: 'Build Main'
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install .NET Core
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0'

    - name: Build
      run: dotnet build Source\csla.test.sln

    - name: Test
      run: dotnet test Source\csla.test.sln --no-build --verbosity normal --filter TestCategory!=SkipOnCIServer --settings Source/test.runsettings
  
  Build_CSLA_MAUI:
    name: 'Build MAUI'
    runs-on: macos-15

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install .NET Core
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0'

    - name: Install MAUI workload
      run: dotnet workload install maui
  
    - name: "Select a specific version of Xcode"
      run: sudo xcode-select -s /Applications/Xcode_16.3.app

    - name: Build iOS
      run: dotnet build Source/csla.maui.test.sln -f net9.0-ios

    - name: Build Android
      run: dotnet build Source/csla.maui.test.sln -f net9.0-Android
    
    - name: Build Android
      run: dotnet build Source/csla.maui.test.sln -f net9.0-maccatalyst
