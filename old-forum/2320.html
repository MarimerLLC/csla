<html><header><title>Root and Child Objects in CSLA</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Root and Child Objects in CSLA</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/2320.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali posted on Sunday, February 11, 2007</h2><P>Hi, <BR>I am coding a VB.NET application for which the database and its Stored procs are already written, The way the Stored procs are written, I can't possibly use the root and child objects as defined in the CSLA , because of the fact that every object should contact the Database by itself. The reason behind this is the Stored procs are pretty simple and return data for an object or a collection of objects. </P>
<P>&nbsp;Any suggestions? or Any one encountered the same problem?</P>
<P>Thanks</P>
<P>Ash</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>William replied on Sunday, February 11, 2007</h2><DIV>Since the stored procedures are written to return object and collection data. I don't quite understand why root/child objects could not be created. Perhaps, you can try to elaborate more.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Regards,</DIV>
<DIV>William</DIV>
<DIV>&nbsp;</DIV></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Sunday, February 11, 2007</h2><P>William, </P>
<P>I can probably understand why are the Stored procs like that, because if we follow the root and child objects model as we have in CSLA, then I will have one root object and 7 child obects, 4 child collection objects and 3 grand child collection objects, so apparently loading all these objects won't be a good idea?? (right? wrong?) considering its a web app.</P>
<P>Now coming to the question why I can't create root/child objects? It was not quite intuitive to me either :) :) because then all the stored procs (for the objects as I explained above) will be called by the root object, right ?</P>
<P>thanks</P>
<P>Ash</P>
<P>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>JonM replied on Sunday, February 11, 2007</h2><P>Ash,</P>
<P>The simplest way to handle this is to only have root editable objects and simply ignore child objects altogether.&nbsp; Or put root collections inside of root objects.&nbsp; The down side is that you lose transaction support meaning that a bug/crash could leave your parent and child objects in inconsistent states.&nbsp; I would strongly recommend writing&nbsp;additional stored procedures (at least for the fetch/update procs).</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Sunday, February 11, 2007</h2><P>JonM,</P>
<P>Thanks for your help, Do you suggest</P>
<P>1) rewriting some of the stored procs like we have example Stored procs in ProjectTracker?</P>
<P>2) or using Trasactions (COM+) in VB.NET code (as supported by CSLA)</P>
<P>Thanks</P>
<P>Ash</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tray replied on Monday, February 12, 2007</h2><P><FONT face=Arial size=2>Hi Ash,</FONT></P>
<P><FONT face=Arial size=2>Another option could be to call more than 1 stored procedure in the data access section of your root object. If there is a stored procedure to retrieve the child data seperatly,&nbsp;you&nbsp;should be able to&nbsp;call one (existing) stored procedure to get the root object data and then call another to get the child data. e.g.</FONT></P><FONT color=#800000 size=2><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>Protected</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Overloads</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT><FONT size=2> DataPortal_Fetch(</FONT><FONT color=#0000ff size=2>ByVal</FONT><FONT size=2> criteria </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Object</FONT><FONT size=2>)<BR></FONT><FONT color=#0000ff size=2>Dim</FONT><FONT size=2> crit </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> Criteria = </FONT><FONT color=#0000ff size=2>DirectCast</FONT><FONT size=2>(criteria, Criteria)</P>
<P></FONT><FONT color=#008000 size=2>'Load values from db<BR></FONT><FONT color=#008000 size=2>'Open connection to db<BR></FONT><FONT color=#0000ff size=2>Using</FONT><FONT size=2> cn </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> SqlConnection(Database.Deed)<BR>&nbsp;&nbsp;&nbsp;cn.Open()</P>
<P></FONT><FONT color=#0000ff size=2><FONT color=#008000 size=2>&nbsp;&nbsp;&nbsp;'Set up command object<BR>&nbsp;&nbsp;&nbsp;</FONT>Using</FONT><FONT size=2> cm </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> SqlCommand = cn.CreateCommand<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>With</FONT><FONT size=2> cm<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.CommandType = CommandType.StoredProcedure<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.CommandText = </FONT><FONT color=#800000 size=2>"getClient"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=2>.Parameters.AddWithValue(</FONT><FONT color=#800000 size=2>"@clientCode"</FONT><FONT size=2>, crit.ClientCode)</P>
<P></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#008000>'Retrieve root object information<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT>Using</FONT><FONT size=2> dr </FONT><FONT color=#0000ff size=2>As</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>New</FONT><FONT size=2> SafeDataReader(.ExecuteReader)<BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With</FONT><FONT size=2> dr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Read()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mClientCode = .GetString(</FONT><FONT color=#800000 size=2>"clientCode"</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mClientName = .GetString(</FONT><FONT color=#800000 size=2>"clientName"</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mInactive = .GetBoolean(</FONT><FONT color=#800000 size=2>"inactive"</FONT><FONT size=2>)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.GetBytes(</FONT><FONT color=#800000 size=2>"lastChanged"</FONT><FONT size=2>, 0, mLastChanged, 0, 8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>With<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#008000>'Reset command object<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#a52a2a>.CommandText = "getClientChildren"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Parameters.Clear<BR></FONT><FONT color=#008000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Add any other parameters required for the child call including parent identifier</FONT></FONT></P>
<P><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>Using <FONT color=#a52a2a>dr</FONT> As New <FONT color=#a52a2a>SafeDataReader(.ExecuteReader)<BR><FONT color=#008000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Pass datareader to child collection</FONT><BR></FONT></FONT><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mClientChildren = ClientChildren.GetClientChild(dr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT color=#0000ff size=2>End</FONT><FONT color=#800000 size=2> </FONT><FONT color=#0000ff size=2>Using</FONT></FONT></P>
<P><FONT color=#0000ff size=2><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End With</FONT><BR></FONT><FONT color=#0000ff size=2>&nbsp;&nbsp;&nbsp;End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Using</P></FONT><FONT size=2>
<P></FONT><FONT color=#0000ff size=2>End</FONT><FONT size=2> </FONT><FONT color=#0000ff size=2>Sub</FONT></P>
<P><FONT color=#0000ff size=2><FONT face=Arial color=#000000>Instead of using the <FONT face="Courier New">.NextResult</FONT><FONT face=Arial> method to move to the next datareader result, grab the data as an independant datareader and pass that to the child collection&nbsp;- the collection will not know the difference.</FONT></FONT></FONT></P>
<P><FONT face=Arial color=#000000>Remember that the Data Access section&nbsp;allows you to&nbsp;do <EM>anything</EM> to retrieve the data required. The object won't know the difference, and neither will its children. You could pull each child in a separate call if you wanted to, but that would be very wasteful.</FONT></P>
<P><FONT face=Arial color=#000000>I think that you should be able to use your existing stored procedures to retrieve the data that you need, you just have to plan how you are going to transform the data from the database into the objects, and this is what the Data Access section is for (or that's what I use it for with existsing db's)</FONT></P>
<P><FONT color=#0000ff size=2><FONT face=Arial color=#000000>Just thought I'd suggest a different approach. The more options the merrier <img src="/emoticons/emotion-1.gif" alt="Smile [:)]" /></FONT></P></FONT></FONT></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Monday, February 12, 2007</h2>Thank you Tray, its so nice of you, <br>
I will definitely follow the solution you suggested.<br>
Ash<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Monday, February 12, 2007</h2>Ash,<br><br>Csla is pretty flexible.&nbsp; I'm not quite sure what your procs return now, but you should be able to use them without modification.<br><br>If they return the root and child objects all in one dataset, you call that procedure in the root's DP_F routine, and pass the result set to child collection which will use it to create child objects (also from the dataset).<br><br>If your procs return only one row at a time, Csla can handle that to.&nbsp; Your child would then know the sql to load itself, and the collection need only get a list of ids of the child rows to load.<br><br>So, tell us what your procs do, and I'm sure we can figure out some way to&nbsp; use them without modification.&nbsp; <br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>xal replied on Monday, February 12, 2007</h2>Well, do consider also the fact that you may not need all that data at once. This is specially true in a web environment, where you usually want to avoid cluttered web pages, so you probably won't display a root with all it's 3 child collections and each of it's children child collections. This is also specially true if you are using session to store the objects, because you'll have a much bigger footprint in your session for no particular reason.<br><br>So, the questions you should ask yourself are "What is really my use case? how will these objects be used? For what purpose(es)?"<br><br>Perhaps it is the case that you need some of those items as child collections, and some as standalone collections. Perhaps you realize that you don't really need them as child collections.<br><br>It is true in most cases that you don't need to load such a deep hierarchy as you mention. It's just that the way the data is structured leads you to thinking that way.<br><br>Perhaps you could design your structure as you mentioned, but only load children on demand (Lazy Loading).<br><br><br>Anyway, there are different ways of doing the same thing, you just need to figure out what's best for you.<br><br><br>Andr√©s<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Monday, February 12, 2007</h2>ajj,<br>
consider a simple scenareio in my app, <br>
One of stored proc returns data for the client, which is a root object,&nbsp; what I do is, store that clientid in session.<br>
<br>
Other stored procs returns result sets for orders and&nbsp; Income info
about client which are child collections of the root object, each of
these stored procs requires clientid, so I pass them the clientid which
I had already stored in session.<br>
This is a very simple example, just to illustrate the point<br>
Thanks<br>
Ash<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Bowman74 replied on Monday, February 12, 2007</h2><P>Ash,</P>
<P>There is no reason why CSLA child collections and child objects cannot handle their own persistence without any modification to the CSLA base classes.&nbsp; The implementation in Rocky's book is just a sample and can be modified to meet your needs.&nbsp; I have done similar in past and it can work with no problems.</P>
<P>There is also no reason why this can't happen all in the same transaction, particularly with .Net 2.0 transaction support.&nbsp; Just make sure your are not opening needless connections to the same database.&nbsp; Prior to .Net 2.0 you would have to manually pass the transaction around to all the child objects.</P>
<P>You should be cognizant of the fact that you will take a performance hit for making more calls to the database.&nbsp; One call that passes a large amount of data will perform better than many calls that each produce a subset.&nbsp; However if your object hierarchies and transaction volume&nbsp;are reasonably sized you should be able to get away with it without the user noticing.</P>
<P>Thanks,</P>
<P>Kevin</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Tray replied on Tuesday, February 13, 2007</h2><P><FONT face=Arial size=2>Hi again Ash,</FONT></P>
<P><FONT face=Arial size=2>I'm glad that my suggestion was helpful.</FONT></P>
<P><FONT face=Arial size=2>I think&nbsp;a bit of qualification is required due to the amount of responses you have received.<BR>I work with Windows Clients exclusivley, so if your application is web-based there may be some better suggestions or additions that are more in line with what you are trying to do.</FONT></P>
<P><FONT face=Arial size=2>It would be good if you could document the procedures that you are using for the root and child object, then we all could see what you are up against.</FONT></P>
<P><FONT face=Arial size=2>xal&nbsp;had a great idea - make sure you establish what data you need before grabbing everything from your db. There is no need to grab a root object and 500 child objects if the user is only going to pick one child object from&nbsp;the list of 500. Lazy loading is definately a consideration in this situation.</FONT></P>
<P><FONT face=Arial size=2>Remember to think of your user when building your apps - there the ones who have to use it. One thing I do my best to avoid is having the user wait ages for the data to be retrieved from the db (that pisses me right off, and I've seen heaps of professional in-house programs that load <EM>thousands</EM> of objects into a treeview - after about 30 seconds or more I get to see the treeview).</FONT></P>
<P><FONT face=Arial size=2>Please keep us up-to-date on your progress.</FONT></P>
<P><FONT face=Arial size=2>Regards<BR>Tray</FONT></P>
<P><FONT face=Arial size=2></FONT>&nbsp;</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Tuesday, February 13, 2007</h2>Hi Tray,<br>
you are right its a web app. thats why I want to make sure I dont load
zillions of objects at one time or everytime I hit the database.<br>
Give me a few days to post my progress as I have still lots of stuff to do on this app.<br>
I will probably start new threads as I face problems,<br>
Thanks for everyone's help<br>
Ash<br>
<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Ashraf Ali replied on Tuesday, February 13, 2007</h2>Hi Folks,<br>
Any one can get hold of some CodeSmith Templates which generates (or
helps in generating) CSLA objects from Stored procs (not from Tables)?<br>
I need these Templates for CSLA.NET 1.1 not 2.0<br>
<br>
Thanks and Regards<br>
Ash<br>
<br>
<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
