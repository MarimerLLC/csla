<html><header><title>Nesting classes</title></header><body><div style='float:right'><a href='http://cslanet.com'><img src='https://github.com/MarimerLLC/csla/raw/master/Support/Logos/csla%20win8_compact_s.png'/></a></div><p><h1>Nesting classes</h1><span style='font-size:small'>Old forum URL: forums.lhotka.net/forums/t/952.aspx</span></p><hr><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 posted on Saturday, August 19, 2006</h2><P>Hi again, apologies for my elementary questions but I'm a bit new to CSLA and this object-orientation lark :)</P>
<P>Have been thinking about nested classes and when and how they should be implemented, specifically with regards to the CSLA framework.</P>
<P>As a simple example, take an address.&nbsp; An address consists of several fields and potentially has business logic to validate the contents or perhaps perform postcode lookups and so forth.&nbsp; As such an address could be used in many places,&nbsp;presumably an Address class would be the way to go to encapsulate this "complex type" and its behaviour?</P>
<P>If so, then you may also have a Contact class which, amongst other fields, contains a nested Address class.&nbsp; What I'm not sure about is how this would work within the CSLA framework.&nbsp; Firstly, with regards to validation, I presume the parent Contact class would simply have a rule which checks the validity of the nested Address class, thus delegating responsibility for validation of the Address to that class.</P>
<P>Of more concern is how you'd bind such an object to an interface.&nbsp; If the interface was required to "flatten" the hierarchy and show the properties of the nested Address class alongside those of the parent Contact class, presumably you'd need two binding sources, one for the Contact object and one for the nested Address and then possibly two error providers, one for each class and so forth.&nbsp; This all seems rather messy tbh.</P>
<P>What's the best way to design such a system?</P>
<P>Toby.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>david.wendelken replied on Saturday, August 19, 2006</h2><P>Take a close look at the sample ProjectTracker application that comes with CSLA.</P>
<P>Change the name from Resource, Assignment and Role to Contact, Address and Address Type respectively and you've got the makings of a solution.</P>
<P>Take a VERY close look at how the CSLADataSources are configured in the sample pages&nbsp;- it's very obvious once you "get" it, but not so obvious as to be intuitive. :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Monday, August 21, 2006</h2><P>Hi David,</P>
<P>Thanks for that.&nbsp; I've had a look at how the sample classes are organised and I think I follow you.&nbsp; If I understand correctly, in my example scenario, the fields constituting the address for the contact would be placed directly in the Contact class but the responsibility for "managing" these fields would be delegated to a separate, static&nbsp;Address class which would contain all the business logic (i.e. rules) for these fields.&nbsp; I'd implement an interface, such as IHoldAddress,&nbsp;defining the properties for the address fields, which would be implemented by the Contact class and any other class which needed to hold an address.&nbsp; The AddBusinessRules method on each of these classes would use the rules defined in the static Address class, each of which would accept an object reference and use the IHoldAddress interface to access the properties.&nbsp; Does this sound right to you?</P>
<P>With regards to data access, if I follow the same pattern implemented by the ProjectResource/Assignment classes then I'd have a dedicated Address table in the database which would hold all addresses and the Contact table would only contain a foreign key reference to this table.&nbsp; This effectively normalises the data in the database whilst normalising behaviour in the business objects.</P>
<P>The only part of this arrangement which feels slightly odd to me is having the actual address fields replicated in each class which requires an address (an Invoice needs a billing adddress, a Delivery needs a shipping address etc).&nbsp; Although the business logic relating to these fields is encapsulated by the Address class, my original thought was that this class should actually store the field data itself and then an instance of the Address class would be nested within the Contact, Invoice and Delivery classes, if you follow my drift.&nbsp; Is this the wrong way to go about things then?&nbsp; I can see how this complicates matters when it comes to data binding with the UI but replicating these same address fields in multiple classes feels a bit wrong to me as I'm duplicating effort, or am I falling into the "normalising data rather than behaviour" trap that Rockford talks about so much in the book?</P>
<P>Cheers,</P>
<P>Toby.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Monday, August 21, 2006</h2>

<p class="MsoNormal">Your concept of nested classes is incorrect.<span>&nbsp; </span>A nested class is a class that is defined inside
another class.<span>&nbsp; </span></p>


<p class="MsoNormal">Properties are not behavior.<span>&nbsp;
</span>It is acceptable to repeat properties as long as you are not repeating
behavior.<span>&nbsp; </span>I really wish there was a
sticky that would explain this in detail.<span>&nbsp;
</span>It seems that many people fall into this same trap.<span>&nbsp; </span></p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Monday, August 21, 2006</h2><P>Ok maybe nested is the wrong word but I'm sure you know what I'm on about.</P>
<P>So is my proposed object design the way to go then?&nbsp; Duplicating the actual fields in each class that utilises an address but factoring out the rules and other behaviour to a static Address class?</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Monday, August 21, 2006</h2><p class="MsoNormal">Yes, I understood what you were talking about.<span>&nbsp; </span>However, it is important to use the correct terminology.<span>&nbsp; </span>It makes it easier to understand the
question.</p>


<p class="MsoNormal">Yes, I believe your suggestion is the CSLA way to do it.<span>&nbsp; </span>Duplicating properties is acceptable as long
as you don’t duplicate the behavior.<span>&nbsp; </span>Objects
are defined by behavior not data.<span>&nbsp; </span>When
using CSLA it is best to use a use-case driven design.<span>&nbsp; </span>Think of the Customer class as a CustomerEdit
class instead.<span>&nbsp; </span>If you take this
approach, it makes more sense to place the address properties in that class.<span>&nbsp; </span>I believe a use-case driven design is different
from a standard OOP design.<span>&nbsp; </span>I think this
is why most people get confused when they start using CSLA.<span>&nbsp; </span>I would personally leave the address
properties in the address class and create an adapter class that encapsulates a customer and address object.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>hurcane replied on Monday, August 21, 2006</h2>Here's a response from a Windows Forms perspective...<br><br>I've gone the route of exposing the Address as an object and using a different data source for binding in my UI. However, that decision was made because of our UI design. My primary object (an order), has multiple addresses (e.g. bill-to, ship-to, ackowledge-to). In my case, the user sees a display-only summary of the address in the order entry UI , but they can access a dialog to edit complete address information. In addition, the users required the ability to configure the display-only version of the address information.<br><br>We have made a smart control that handles the read-only address customization requirements. We bind this smart control to the appropriate address property. The dialog form is also bound to an Address object.<br><br>We could have flattened this object structure, as others have suggested, but that didn't seem to fit our needs for the UI. Both solutions will work. You have to decide which one best fits your needs. Sometimes it comes down to flipping a coin. <img src="/emoticons/emotion-2.gif" alt="Big Smile [:D]" /><br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Tuesday, August 22, 2006</h2><P>Hurcane, that's very similar to my original idea.&nbsp; I too would have certain classes which contain multiple addresses and it just strikes me that having all the address fields (seven in total) repeated over and over isn't very good design.&nbsp; Apart from the issue of duplicating the fields in separate classes, in cases where a single class needs to hold several addresses, you're looking a load of fields, many of which are effectively identical.&nbsp; Whilst the business logic for these fields would be delegated to a dedicated, static class, you'd still be "clogging up" the main classes with these fields.</P>
<P>It is for this reason that I thought factoring out the actual field data to a separate class and embedding (is that the right word?) an instance (or several instances) of this class where needed would be a much cleaner design.&nbsp; Yes it's normalising data, but is this always a bad thing?&nbsp; The behaviour would still be normalised so it's not a case of normalising data <EM>instead</EM> of behaviour, just aswell as.</P>
<P>As for the interface, I can see what you're on about with delegating editing of address details to a separate control or dialog and although I might want to do this in some places, in many I would not.&nbsp; In cases where I wish to view the address fields in a "flat" list alongside the other class fields, it would complicate matters slightly in that I'd need a second binding source for the embedded address object.&nbsp; What I'm trying to work out is (a) whether the advantage of factoring out the field data to a separate class outweighs the disadvantage of the interface binding complication and (b) whether there are any other issues with this design that I've not yet thought of.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 22, 2006</h2>Vertigo,<br><br>I think creating an Address class (or classes) embeding the Address class as a property is fine.&nbsp;&nbsp;&nbsp;&nbsp; Each address may have its own rules and behaviors, which the customer object doesn't really care about nor should be responsible for.&nbsp; If the rules for the Address changes, it should not affect your customer object.<br><br>I do this typically:<br>public Address ShipToAddress {<br>&nbsp;&nbsp;&nbsp; get { return shipToAddress; }<br>&nbsp;&nbsp;&nbsp; private set { shipToAddress = value; } // We dont want customer clients to push in their own object, just modify the existing one<br>}<br><br>You could also do this, if your ship to address has different behavior than your billing address:<br>public ShipToAddress ShipToAddress { /* code here */ }<br><br>If any address types share identical behvaior, you can encapsulate that within an internal only class, which the public addresses use.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Tuesday, August 22, 2006</h2><P>Hi Andy,</P>
<P>Cheers for that, nice to know I'm not going totally potty and others are doing things this way :)</P>
<P>Of course, even if the fields themselves weren't stored in a separate Address class, the behaviour could still be normalised out by placing the rules in there, as per the Assignment class in the Project Tracker application but I personally think it will make things much clearer to have all the data stored in the Address class to and reduce each address instance in other classes to a single field/property.</P>
<P>You said you typically do it this way, can I ask how much it complicates the interface and whether it causes any other issues elsewhere?&nbsp; In many places I will need a flat list of controls bound to properties of the main object, so in the case of a Customer object I might have a flat list of controls for Forename, Surname, Salutation, Telephone, Address1, Address2, Address3...</P>
<P>In this situation I'm going to need two binding sources, one for the main object to which the Forename, Surname, Salutation and Telephone would be bound and another for the embedded Address object, to which the Address1,2,3... fields would be bound.&nbsp; I presume this is how you do it?&nbsp; Does it work ok?</P>
<P>Cheers,</P>
<P>Toby.</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 22, 2006</h2>Toby,<br><br>Part of the reason I believe in seperating it is because Address is one of those things were the rules likely are shared among use cases, although not always.&nbsp; It also reduces the number of properties on the parent object, which I think is important.&nbsp; Ever had to learn an object which has over 500 properties?&nbsp; Not an easy task..<br><br>The situation where it complicates things is when you're displaying address data in some kind of grid.&nbsp; Typically these are reaonly objects though, and may not necessarly have all the detail your editing object would expose.&nbsp; Here, I simplify the object model a bit.<br><br>You will need two binding sources; your main binding source, and then a second one (and third, forth depending how many complex objects you have).&nbsp; The secondary binding sources will have their DataSource as the first binding source, and the data member as the comlex property.&nbsp; You'll have to type that in manually as the designer won't show the property in the dropdown, but it the binding sources work together just fine.<br><br>HTH<br>Andy<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Tuesday, August 22, 2006</h2>

<p class="MsoNormal">As I
stated in my previous response, I prefer keeping the address properties in the
address class. <span>&nbsp;</span>I share your concerns as
well. <span>&nbsp;</span>I also stated that you could use a
wrapper class to bind to these classes.<span>&nbsp; </span>Couldn’t
you create another class that implements a customer and address interface?<span>&nbsp; </span>You would pass a customer and address object
to this object and use it in the form.<span>&nbsp; </span>I
haven’t tried it, but you should be able to bind to it.<span>&nbsp; </span>This would allow you to keep your hierarchy
the way you want it and also allow you to flatten it for data binding.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Tuesday, August 22, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>malloc1024:</strong></div><div> 
<P class=MsoNormal>As I stated in my previous response, I prefer keeping the address properties in the address class. <SPAN>&nbsp;</SPAN>I share your concerns as well. <SPAN>&nbsp;</SPAN>I also stated that you could use a wrapper class to bind to these classes.<SPAN>&nbsp; </SPAN>Couldn’t you create another class that implements a customer and address interface?<SPAN>&nbsp; </SPAN>You would pass a customer and address object to this object and use it in the form.<SPAN>&nbsp; </SPAN>I haven’t tried it, but you should be able to bind to it.<SPAN>&nbsp; </SPAN>This would allow you to keep your hierarchy the way you want it and also allow you to flatten it for data binding.</P>
<P></div></BLOCKQUOTE></P>
<P>Hmm, I see what you're driving at but wouldn't this cause even more grief, as the wrapper class would need to duplicate each property of the main (eg. Customer) class <EM>and</EM> each property of the Address class, just to pass everything between the original objects and the UI?&nbsp; I can see how it could be used to "flatten" the hierarchy but I don't wonder if it's causing more problems than it solves.</P>
<P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div></P>
<P>The situation where it complicates things is when you're displaying address data in some kind of grid.&nbsp; Typically these are reaonly objects though, and may not necessarly have all the detail your editing object would expose.&nbsp; Here, I simplify the object model a bit.<BR></div></BLOCKQUOTE></P>
<P>I'd not thought about grids, that's a very good point as the individual address fields would need to be displayed in a grid.&nbsp; How exactly are you handling this?&nbsp; My first thought was that the main class could expose a single, read-only string property which returned a single-line representation of the address, delegating the work to the Address class.&nbsp; This would then allow this single property to be bound to a column of the grid removing the dual-level binding problem.&nbsp; Of course, if the grid's own search logic was to be used then it would only be possible to search on the single string representation as a whole rather than on a specific address field.&nbsp; Whilst part of me thinks I could get away with that, the devil on my shoulder is pointing out that some awkward user will ask for it at some point :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Tuesday, August 22, 2006</h2><BLOCKQUOTE><div><img src="/Themes/basicblue/images/icon-quote.gif"> <strong>Vertigo1:</strong></div><div>I'd not thought about grids, that's a very good point as the individual address fields would need to be displayed in a grid.&nbsp; How exactly are you handling this?&nbsp; My first thought was that the main class could expose a single, read-only string property which returned a single-line representation of the address, delegating the work to the Address class.&nbsp; This would then allow this single property to be bound to a column of the grid removing the dual-level binding problem.&nbsp; Of course, if the grid's own search logic was to be used then it would only be possible to search on the single string representation as a whole rather than on a specific address field.&nbsp; Whilst part of me thinks I could get away with that, the devil on my shoulder is pointing out that some awkward user will ask for it at some point :)</div></BLOCKQUOTE><br><br>Well the read only object doesn't have nearly as many properties (because most of them are not relevent in a grid listing) so I just have an AddressLine1, Addressline2, etc. properties.&nbsp; Its a different use case, so there are different expectations and design to handle this case.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>DansDreams replied on Tuesday, August 22, 2006</h2>Looking at the complete picture, there seems to me to be a lot of value of having a separate Address class AND a user control for editing it in the typical contexts of an aggregating&nbsp;class or address list container.</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Tuesday, August 22, 2006</h2><P><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>ajj3085:</strong></div><div><BR>Well the read only object doesn't have nearly as many properties (because most of them are not relevent in a grid listing) so I just have an AddressLine1, Addressline2, etc. properties.&nbsp; Its a different use case, so there are different expectations and design to handle this case.<BR></div></BLOCKQUOTE></P>
<P>Yeah I had the same thought shortly after posting, why not have the main <EM>editable</EM> class contain an embedded instance of the Address class, possibly with the aforementioned single address field for convenience, yet use individual fields in the read-only version used for searches and so forth.&nbsp; Definitely think that's the way forward with this.</P>
<P>I also thought a bit more about the single string field I mentioned.&nbsp; My original idea was that this would be a read-only property to display the address for info and if the user wanted to edit it they'd pop up a separate dialog which would bind each property in the embedded object.&nbsp; Why not, however, have this single string property read/write, with some business logic in the Address class to parse the address out into the relevant fields, thus enabling users to just type a load of text in and have the software make sense of it for them.&nbsp; They could still pop up&nbsp;the full editing dialog if they so desired.&nbsp; I think I like that solution :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Tuesday, August 22, 2006</h2><span>When you are designing your business objects, you
should not even think about the presentation layer.<span>&nbsp; </span>You should develop your business layer
without giving thought to the presentation layer or data binding.<span>&nbsp; </span>If the presentation layer wants something different
that the business layer provides, you add an extra layer between the
presentation and business layer to bridge the gap.<span>&nbsp; </span>This is typically how it is done.<span>&nbsp; </span>Designing the business layer with the presentation
layer in mind will only result in poor design.</span></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Wednesday, August 23, 2006</h2>Hmm, not sure I agree with that to be honest.&nbsp; Whilst I appreciate that the layers should be separated and the business logic layer should have no knowledge nor dependence on the UI or presentation layers, the interface requirements in terms of presentation and editing of data do have a bearing on what properties and functions are exposed by the business logic.&nbsp; Surely this is what use cases are all about, defining the needs of the user, and thus the interface, in order to extrapolate what facilities the business logic layer needs to provide?</div><div style='padding:0 15 3 15;background-color:powderblue'><h2>malloc1024 replied on Wednesday, August 23, 2006</h2>

<p class="MsoNormal">I should clarify what I said earlier.<span>&nbsp; </span>I meant that you should not think about a
specific UI when you are developing your business objects.<span>&nbsp; </span>Not all UI’s use binding, therefore it’s not a
good idea to change your business objects to make binding easier.<span>&nbsp; </span>IMO, it seems like a bad idea to change your
business objects to fit your UI.<span>&nbsp; </span>Your solution
looks good.<span>&nbsp; </span>However, making a habit of changing
your business object to fit your UI will lead to design issues.</p></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>Vertigo1 replied on Wednesday, August 23, 2006</h2><P>Ah right, I'm with you now and agree with what you're saying :)</P>
<P>Whilst I don't want to tailor the business logic to suit a specific UI, I obviously want to make it as flexible as possible which is why I'm trying to think of the different ways users might want to interact with the objects and their properties, such as the ability to either view/edit the address as a single block of text or discrete properties as mentioned earlier.</P>
<P>I don't know about others here, but one of my biggest hates with development is when the boss comes in with some user requirement which I can't implement in the UI without modifying the business logic to expose extra detail/properties/objects etc.&nbsp; Obviously in many cases this is unavoidable but I like to do my best to anticipate every "petty" user whim :)</P></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, August 23, 2006</h2>Well to be fair that 'petty' change is a change in the use case I would think, which would dictate a change in the design.&nbsp; Of course it doesn't seem like your manager should just be able to willy nilly change use cases like that on you either.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>RockfordLhotka replied on Wednesday, August 23, 2006</h2><BLOCKQUOTE><div><img src="/Themes/default/images/icon-quote.gif"> <strong>malloc1024:</strong></div><div><p class="MsoNormal">I should clarify what I said earlier.<span>&nbsp; </span>I meant that you should not think about a
specific UI when you are developing your business objects.<span>&nbsp; </span>Not all UI’s use binding, therefore it’s not a
good idea to change your business objects to make binding easier.<span>&nbsp; </span>IMO, it seems like a bad idea to change your
business objects to fit your UI.<span>&nbsp; </span>Your solution
looks good.<span>&nbsp; </span>However, making a habit of changing
your business object to fit your UI will lead to design issues.</p></div></BLOCKQUOTE><br><br>I agree in general. The one exception to this however, is that you may need to consider whether your UI will run in a stateful or stateless setting. Unfortunately, this can require substantial changes to the way you build your object model. Not so much because of the specific UI, but because of the stateless/stateful choice.<br><br>If you are able to be stateful, then you can employ the full range of OO design possibilities - allowing your object model to naturally reflect the relationships between various objects within a broad use case.<br><br>If you are required to be stateless, then each request must be viewed as an independent use case. This level of atomicity means that you are rarely able to allow object relationships to assist you in providing natural business behaviors, and you have to write them by hand in a more explicit manner. A pure stateless model should, therefore, be avoided unless it is really required to enable high levels of scalability.<br><br>For example, are duplicate line items allowed on a sales order? In a stateful model, your Order object will have a LineItems collection which can easily implement such a restriction. But in a stateless model, each line item is added on a seperate page (request) and so the adding of a line item becomes its own use case. There IS NO LineItems collection - each line item saves itself directly to the database. Thus each line item must implement its own logic, PLUS the logic that should have been in the LineItems collection.<br><br>Alternately, you could allow the user to enter duplicate line items, and have a final use case like CommitOrder where you tell them that they messed up 10 steps earlier and need to fix their order (which is probably not a great approach).<br><br>Ultimately, stateless models should be minimized, as they are more expensive in terms of coding and maintenance - but they are sometimes necessary.<br><br>Beyond the stateful/stateless question, I agree that the object model should reflect the business use cases, not the UI "user experience" - any more than absolutely necessary anyway.<br></div><div style='padding:0 15 3 15;background-color:powderblue'><h2>ajj3085 replied on Wednesday, August 23, 2006</h2>I agree, but you can't totaly ignore it either.&nbsp; In the case of the readonly object, should you make the address a 'complex' property or just include al the address properties as direct properties of the main readonly object?&nbsp; <br><br>In this case, it doesn't really matter either way, until you want to display the read only objects in a grid.&nbsp; One way will be more complex; you'll have to figure out how to use the Format event get the proper values in the grid, or write a UI wrapper object which exposes the data as a single 'flat' object.&nbsp; <br>The other way requires less code in the UI layer.<br><br>Yes, while you're right you shouldn't design your BOs according to the presentation, I think this is one of those cases were its ok, because the end design doesn't really 'matter' too much one way or the other... so why not pick the way that makes coding the UI easier (in this particular case).<br></div><p style='font-size:small'>Copyright (c) Marimer LLC</body></html>
